with mo(data) as (SELECT value FROM mm.adj WHERE (key = 'DISPLAY_NUM_FORMAT'     and section = 'IB'))


SELECT DISTINCT * FROM
    ((SELECT upper(concat_ws(' ', md.surname, md.name, md.patron)) as fio,
          md.id                        as mdoc_id /*hospdoc */
           , mm.mdoc_get_num_format(md.num, md.year, md.num_org,
                                    md.num_filial, md.num_type,
                                    mdt.id, mdt.class,
                                    data) as ib_num
      FROM mm.hospdoc hd
               JOIN mo on true
               JOIN mm.mdoc md on md.id = hd.mdoc_id
               JOIN mm.mdoc_type         mdt on mdt.id = md.mdoc_type_id
               JOIN mm.people p on md.people_id = p.id
      )

      UNION ALL

      SELECT upper(concat_ws(' ', md.surname, md.name, md.patron)) as fio,
          md.id                                                 as mdoc_id    /*ambticket */
           ,mm.mdoc_get_num_format(md.num,md.year,md.num_org,
                                   md.num_filial,md.num_type,
                                   mdt.id,mdt.class,
                                   data)                as ib_num
      FROM mm.ambticket a
               JOIN mo on true
               JOIN mm.mdoc md on md.id = a.mdoc_id
               JOIN mm.mdoc_type         mdt on mdt.id = md.mdoc_type_id
               JOIN mm.people p on md.people_id = p.id) as t
